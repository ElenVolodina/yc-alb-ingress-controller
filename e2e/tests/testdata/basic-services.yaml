apiVersion: v1
kind: Service
metadata:
  labels:
    app: grpc-testapp
  name: grpc-testapp-service
  namespace: testapp-ns
  annotations:
    ingress.alb.yc.io/protocol: grpc
spec:
  type: NodePort
  ipFamilyPolicy: PreferDualStack
  ipFamilies:
    - IPv4
    - IPv6
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
      nodePort: 30082
    - name: tls
      port: 8443
      targetPort: 8443
      protocol: TCP
      nodePort: 30083
  selector:
    app: grpc-testapp
---
apiVersion: v1
kind: Service
metadata:
  name: h2c-testapp-service
  namespace: testapp-ns
spec:
  ipFamilyPolicy: PreferDualStack
  ipFamilies:
    - IPv4
    - IPv6
  selector:
    app: h2c-testapp
  type: NodePort
  ports:
    - name: http
      port: 80
      targetPort: 80
      protocol: TCP
      nodePort: 30084
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: testapp
  name: testapp-service
  namespace: testapp-ns
spec:
  ipFamilyPolicy: PreferDualStack
  ipFamilies:
    - IPv4
    - IPv6
  type: NodePort
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
      nodePort: 30080
  selector:
    app: testapp
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: testapp
  name: testapp-service
  namespace: testapp2-ns
spec:
  ipFamilyPolicy: PreferDualStack
  ipFamilies:
    - IPv4
    - IPv6
  type: NodePort
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
      nodePort: 30081
  selector:
    app: testapp
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: testapp2
  name: testapp-service2
  namespace: testapp-ns
spec:
  ipFamilyPolicy: PreferDualStack
  ipFamilies:
    - IPv4
    - IPv6
  type: NodePort
  ports:
    - name: http
      port: 8081
      targetPort: 8081
      protocol: TCP
      nodePort: 30085
  selector:
    app: testapp2